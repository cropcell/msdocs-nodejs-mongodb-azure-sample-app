extends layout

block content
  body(class='p-2')
    form(action='./updateVotes' method='POST' class='form-registration')
      div(class="header")
        div(class="header-container")
          button(class='config btn' type='button' id="showMood") mood board
          button(class='config btn' type='button' id="showVoted") show all
          button(class='config btn' type='button' id="hideVoted") hide voted
          button(class='config btn' type='button' id="sortAbc") sort abc
          button(class='config btn' type='button' id="sortRandom") sort random
          button(class='btn btn-danger btn-sm mx-1') save
      main(class='container')
        div(class='d-flex align-items-center p-3 my-1')
            div(class='1h-1')              
              div(class="allVoteContainer")
                each nameVote in votesToRender
                  div(id=`${nameVote.name}` class='multiButton') 
                    div() #{nameVote.name}
                    input(type='hidden' name='_id' value=`${nameVote._id}`)
                    input(type='hidden' name='name' value=`${nameVote.name}`)
                    span(class='btn downvote') &#128403;
                    span(class='btn upvote') &#128402;
                    input(type='hidden' name='vote' value=`${nameVote.vote}`)
              

  script.

    document.getElementById('showVoted').onclick = function (e) { 
      if(window.location.href.indexOf("hideVoted") >= 0){
        window.location.href = window.location.href.replace("hideVoted=1", "" ).replace("&", "" );;
      }
    }
    document.getElementById('hideVoted').onclick = function (e) { 
      if(!window.location.href.indexOf("hideVoted") >= 0 && window.location.href.indexOf("sort") >= 0){
        window.location.href = window.location.href.replace("?sort", "?hideVoted=1&sort" );
      }
      else if(window.location.href.indexOf("hideVoted") < 0 && window.location.href.indexOf("sort") < 0){
        window.location.href = window.location.href.replace( /[\?#].*|$/, "?hideVoted=1" );
      }
    }
    document.getElementById('sortAbc').onclick = function (e) { 
      if(window.location.href.indexOf("sortRandom") >= 0){
        window.location.href = window.location.href.replace("sortRandom", "sortAbc" );
      }
      else if(window.location.href.indexOf("sort") < 0 && window.location.href.indexOf("hideVoted") >= 0){
        window.location.href = window.location.href.concat("&sortAbc=1");
      }
      else if(window.location.href.indexOf("sort") < 0 && window.location.href.indexOf("hideVoted") < 0){
        if(window.location.href.indexOf("?") < 0){
          window.location.href = window.location.href.concat("?");
        }
        window.location.href = window.location.href.replace("?", "?sortAbc=1" );
      }
    }
    document.getElementById('sortRandom').onclick = function (e) { 
      if(window.location.href.indexOf("sortAbc") >= 0){
        window.location.href = window.location.href.replace("sortAbc", "sortRandom" );
      }
      else if(window.location.href.indexOf("sort") < 0 && window.location.href.indexOf("hideVoted") >= 0){
        window.location.href = window.location.href.concat("&sortRandom=1");
      }
      else if(window.location.href.indexOf("sort") < 0 && window.location.href.indexOf("hideVoted") < 0){
        if(window.location.href.indexOf("?") < 0){
          window.location.href = window.location.href.concat("?");
        }
        window.location.href = window.location.href.replace("?", "?sortRandom=1" );
      }
      else if(window.location.href.indexOf("sortRandom=1")>=0){
        window.location.href = window.location.href;
      }
    }





    for(var i in document.getElementsByClassName('multiButton')){
      var voteBox = document.getElementsByClassName('multiButton')[i];
      if(voteBox.childNodes && voteBox.childNodes.length > 6){
        var vote = parseInt(voteBox.childNodes[6].value);
        console.log( voteBox.childNodes[5]);
        if(vote > 0){
          console.log("upvote");
          voteBox.childNodes[5].classList.add("selected");
        }
        else if(vote < 0){
          console.log("downvote");
          voteBox.childNodes[4].classList.add("selected");
        }
      }
    }


    for(var i in document.getElementsByClassName('multiButton')){
      document.getElementsByClassName('upvote')[i].onclick = function (e) {  
        var parent = e.target.parentElement;
        console.log(parent.childNodes);
        if(parent.childNodes[4].classList.contains("selected")){
          parent.childNodes[4].classList.remove("selected");
          parent.childNodes[5].classList.add("selected");
          parent.childNodes[6].value = 1;
        }
        else if(parent.childNodes[5].classList.contains("selected")){
          parent.childNodes[5].classList.remove("selected");
          parent.childNodes[6].value = 0;
        }
        else{
          parent.childNodes[5].classList.add("selected");
          parent.childNodes[6].value = -1;
        }
      };
      document.getElementsByClassName('downvote')[i].onclick = function (e) {  
        var parent = e.target.parentElement;
        console.log(parent.childNodes);
        if(parent.childNodes[5].classList.contains("selected")){
          parent.childNodes[5].classList.remove("selected");
          parent.childNodes[4].classList.add("selected");
          parent.childNodes[6].value = -1;
        }
        else if(parent.childNodes[4].classList.contains("selected")){
          parent.childNodes[4].classList.remove("selected");
          parent.childNodes[6].value = 0;
        }
        else{
          parent.childNodes[4].classList.add("selected");
          parent.childNodes[6].value = 1;
        }
      };
    }